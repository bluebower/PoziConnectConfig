# Pozi Connect M1 SQL

Pozi Connect compares Vicmap and Council datasets to generate an M1 spreadsheet. The M1 contains all property and address changes for the amendment of the state-wide Vicmap property and address datasets.

The rules and processes for submitting M1s are controlled by the Department of Environment and Primary Industries (DEPI). The full documentation is found [here](http://www.dse.vic.gov.au/__data/assets/pdf_file/0006/150927/M1_V12_Documentation_27112012.pdf) (pdf).

The primary data tables used by Pozi Connect in the comparison are listed here. They have been generated by earlier Pozi Connect extraction and processing tasks.

* Vicmap Parcel (derived from VMPROP tables)
* Vicmap Property Address (derived from VMADD and VMPROP tables)
* Council Parcel (derived from various tables in Council's property system)
* Council Property Address (derived from various tables in Council's property system)

(Also used are supplementary tables generated by Pozi Connect that contain counts of properties in parcels, parcels in properties, etc, to assist with determining what types of edits apply.)

## Edit Code ‘C’

DEPI:
>Edit Code C is used for only updating the parcel based Council Reference number (Crefno). This edit code can be used 
to populate or null a Crefno.

Comparing Vicmap Parcel against Council Parcel based on a common `spi`:

* where Vicmap `crefno` is null and the Council `crefno` is populated, then **update with the *first* Council `crefno` value**

Looking at all Vicmap Parcels:

* where Vicmap `crefno` value doesn't exist in Council Parcel and...
  * there exists an alternative Council `crefno` value for that parcel, then **update with the *first* Council `crefno` value**
  * there is no Council `crefno` value for that parcel, then **null the `crefno`**

## Edit Code ‘P’

DEPI:
>Edit Code P updates property details for a given record. It requires that the Property Details are populated as required including propnum and Crefno (if used by LGA). If Crefno is left blank the existing CREFNO value in the parcel table will be retained.

Comparing Vicmap Parcel against Council Parcel based on a common `spi` value:

* where Vicmap `propnum` is null, and one or more Council records have a populated `propnum`, then **update with the first Council `propnum` value**

Looking at all Vicmap Parcels:

* where Vicmap `propnum` value doesn't exist in Council Parcel `propnum`, and...
  * there exists one or more alternative Council `propnum` for that parcel, then **update with the first Council `propnum` value**
  * there is no Council `propnum` value for that parcel, then **null the `propnum`**

## Edit Code ‘A’

DEPI:
>Edit Code A is only used to add a property to either create a Multi Assessment or add a further multi assessment record.

Notes:

- if parcel is part of multi-parcel property, submit `property_pfi` and not `parcel_pfi`

## Edit Code ‘R’

>_DEPI: Edit Code R is only used to remove a property from a Multi Assessment. The last record on a multi assessment cannot be retired._

Notes:

- ensure property is multi-assessment
- submit `property_pfi`

## Edit Code ‘S’

DEPI:
>Edit Code S updates address details for a given record. It requires that the Address – Road and Locality Information columns are populated as required including the Address – Location attributes for creating spatially located address points.

Comparing primary Vicmap Property Addresses against non-secondary Council Property Addresses based on a common `propnum` value:

* where Vicmap `num_road_address` is not equal to Council `num_road_address`, then **update with Council address values**

Looking at all non-secondary Council Property Addresses:

* where `propnum` value does not exist in Vicmap Property and the value exists in M1_P_Edit, then **update with Council address values**

## Edit Code ‘B’

DEPI:
>Edit Code B is only to be used when removing a primary property from the base or retiring the whole base.

Not yet implemented.

## Edit Code ‘E’

DEPI:
>Edit Code E updates both property and address details for a given record. It requires that the Property Details and Address – Road and Locality Information columns are populated as required.

Pozi Connect handles its property, parcel and address edits using the appropriate single-purpose edit codes (C for parcels; P, A and R for properties; S for addresses). The E edit code will not be used.

## Edit Code ‘Z’

DEPI:
>Edit code Z is only used to remove secondary addresses. It will not remove a primary distance based address.

Council property systems are generally not reliable sources of secondary address information. Accordingly, Pozi Connect will not attempt to retire secondary addresses. The Z edit code will not be used.


