# Pozi Connect M1 SQL

Pozi Connect compares Vicmap and Council data to generate an M1 spreadsheet. The M1 contains all property and address changes within councils for the amendment of the state-wide Vicmap property and address datasets.

The basis for generating records for the M1 is to do various comparison queries that correspond to the [permitted DEPI edit codes](http://www.dse.vic.gov.au/__data/assets/pdf_file/0006/150927/M1_V12_Documentation_27112012.pdf) (PDF).

The primary data tables used in the comparison are listed here. They have been generated by earlier Pozi Connect extraction and processing tasks.

* Vicmap Parcel
* Vicmap Property Address
* Council Parcel
* Council Property Address

(There are also supplementary tables generated by Pozi Connect that contain counts of properties in parcels, parcels in properties, etc, to assist with determining what types of edits apply.)

## Edit Code ‘B’

>DEPI: Edit Code B is only to be used when removing a primary property from the base or retiring the whole base.

Not yet implemented.

## Edit Code ‘C’

>DEPI: Edit Code C is used for only updating the parcel based Council Reference number (Crefno). This edit code can be used 
to populate or null a Crefno.

Comparing Vicmap Parcel against Council Parcel based on a common `spi`:

* where Vicmap `crefno` is null and the Council `crefno` is populated, then **update with Council `crefno` value**

Looking at all Vicmap Parcels:

* where Vicmap `crefno` is populated but the value doesn't exist in *any* Council `crefno` and
  * there exists an alternative Council `crefno` value for that parcel, then **update with Council `crefno` value**
  * there is no Council `crefno` value for that parcel, then **null the `crefno`**

## Edit Code ‘E’

>DEPI: Edit Code E updates both property and address details for a given record. It requires that the Property Details and Address – Road and Locality Information columns are populated as required.

**This edit code will not be supported by Pozi Connect because of the complexity involved in updating too many different elements in a single edit.**

## Edit Code ‘P’

>DEPI: Edit Code P updates property details for a given record. It requires that the Property Details are populated as required including propnum and Crefno (if used by LGA). If Crefno is left blank the existing CREFNO value in the parcel table will be retained.

Comparing Vicmap Parcel against Council Parcel based on a common `spi` value:

* where Vicmap `propnum` is null, and one or more Council records have a populated `propnum`, then **update with the first Council `propnum` value**

Looking at all Vicmap Parcels:

* where Vicmap `propnum` is populated but the value doesn't exist in *any* Council `propnum`, and...
  * there exists one or more alternative Council `propnum` for that parcel, then **update with the first Council `propnum` value**
  * there is no Council `propnum` value for that parcel, then **null the `propnum`**

Notes

* what to do in scenarios 1 and 2 if count is more than 1?


## Edit Code ‘S’

>DEPI: Edit Code S updates address details for a given record. It requires that the Address – Road and Locality Information columns are populated as required including the Address – Location attributes for creating spatially located address points.

## Edit Code ‘Z’

>DEPI: Edit code Z is only used to remove secondary addresses. It will not remove a primary distance based address.

## Edit Code ‘A’

>DEPI: Edit Code A is only used to add a property to either create a Multi Assessment or add a further multi assessment record.

### Development notes:

- if parcel is part of multi-parcel property, submit `property_pfi` and not `parcel_pfi`

## Edit Code ‘R’

>_DEPI: Edit Code R is only used to remove a property from a Multi Assessment. The last record on a multi assessment cannot be retired._

### Development notes:

- ensure property is multi-assessment
- submit `property_pfi`
